        <!DOCTYPE html>
        <html lang="es">
        <head>
          <meta charset="UTF-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
          <title>Mapa Interactivo Europa</title>

          <!-- Fuente de Google para la tipograf√≠a Roboto -->
          <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

          <!-- Estilos base de Leaflet (necesarios para el mapa) -->
          <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

          <!-- Google Fonts: Poppins -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Leaflet base styles -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
  /* Estilo general con tipograf√≠a Poppins */
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background-color: #f3f3f3;
  }

  /* Mapa ocupa toda la pantalla */
  #map {
    height: 100vh;
    width: 100%;
  }

  /* Estilo de etiqueta flotante */
  .country-label {
    position: absolute;
    background: rgba(33, 37, 41, 0.92);
    color: #fff;
    padding: 6px 10px;
    border-radius: 8px;
    font-size: 13px;
    pointer-events: none;
    z-index: 1000;
    display: none;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
    font-weight: 500;
  }

  /* Bandera en tooltip */
  .country-label img {
    width: 32px;
    height: 22px;
    object-fit: cover;
    border: 1px solid white;
    border-radius: 3px;
  }

  /* Popup del mapa */
  .leaflet-popup-content {
    font-family: 'Poppins', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.4;
  }

  .leaflet-popup-content strong {
    font-weight: 600;
    font-size: 15px;
  }

  .leaflet-popup-tip {
    background: rgba(33, 37, 41, 0.92);
  }

  .leaflet-popup-content-wrapper {
    background: rgba(255, 255, 255, 0.96);
    border-radius: 12px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    padding: 10px;
  }
.leaflet-interactive.hovered {
  transform: scale(1.02);
  transform-origin: center;
  transition: transform 0.2s;
}

</style>

        </head>
        <body>
          <!-- Contenedor principal del mapa -->
          <div id="map">
            <!-- Etiqueta que aparece al pasar el mouse por un pa√≠s -->
            <div id="countryLabel" class="country-label"></div>
          </div>

          <!-- Script de Leaflet para crear y controlar el mapa -->
          <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
          <script src="https://unpkg.com/leaflet-ant-path@1.3.0/dist/leaflet-ant-path.min.js"></script>


          <script>
            
  // Crear el mapa y centrarlo sobre Europa
  const map = L.map('map').setView([47, 10], 4.55);

  // Capa base de OpenStreetMap
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Referencia al div flotante de pa√≠s
  const countryLabel = document.getElementById('countryLabel');

 // Crear los grupos de capas para el filtrado
const layerGroupPuertos = L.layerGroup();
const layerGroupAeropuertos = L.layerGroup();

const overlays = {
  'üõ≥Ô∏è Puertos': layerGroupPuertos,
  '‚úàÔ∏è Aeropuertos': layerGroupAeropuertos
};

// ------ FUNCIONES PARA GUARDAR Y RESTAURAR CAPAS ACTIVAS ------
function getActiveLayers() {
  try {
    return JSON.parse(localStorage.getItem("activeLayers")) || [];
  } catch {
    return [];
  }
}

function saveActiveLayers(activeLayers) {
  localStorage.setItem("activeLayers", JSON.stringify(activeLayers));
}

// Control de capas
const layersControl = L.control.layers(null, overlays).addTo(map);

// --- A√±adir los grupos al mapa seg√∫n lo que el usuario dej√≥ activo ---
const activeLayers = getActiveLayers();
if (activeLayers.includes('üõ≥Ô∏è Puertos')) layerGroupPuertos.addTo(map);
if (activeLayers.includes('‚úàÔ∏è Aeropuertos')) layerGroupAeropuertos.addTo(map);

// --- Detectar cambios de filtros y guardarlos ---
map.on('overlayadd overlayremove', function() {
  const shown = [];
  if (map.hasLayer(layerGroupPuertos)) shown.push('üõ≥Ô∏è Puertos');
  if (map.hasLayer(layerGroupAeropuertos)) shown.push('‚úàÔ∏è Aeropuertos');
  saveActiveLayers(shown);
});


  // Listado de pa√≠ses con color rojo (coloreados por imagen)
  const paisesColoreadosImagen = new Set([
    "Portugal", "France", "Belgium", "Luxembourg", "Germany", "Switzerland", "Austria", "Italy", "Monaco",
    "San Marino", "Liechtenstein", "Andorra", "United Kingdom", "Ireland", "Norway", "Sweden", "Finland",
    "Denmark", "Iceland", "Estonia", "Latvia", "Lithuania", "Poland", "Czechia", "Slovakia", "Hungary",
    "Slovenia", "Croatia", "Bosnia and Herzegovina", "Serbia", "Republic of Serbia", "Montenegro", "Kosovo",
    "Albania", "North Macedonia", "Greece", "Bulgaria", "Romania", "Moldova", "Ukraine", "Belarus",
    "Russia", "Georgia", "Armenia", "Azerbaijan", "Kazakhstan"
  ]);

  // Pa√≠ses destacados en color verde
  const paisesVerdes = new Set([
    "Italy", "Germany", "Netherlands", "France", "Spain",
    "Belgium", "Luxembourg", "Portugal", "Bulgaria", "Poland"
  ]);

  // Enlaces a archivos HTML por pa√≠s
  const paisesObjetivo = {
    "Spain": "espana.html", "France": "francia.html", "Germany": "alemania.html", "Italy": "italia.html",
    "Portugal": "portugal.html", "Belgium": "belgica.html", "Poland": "polonia.html",
    "Netherlands": "paises_bajos.html", "Bulgaria": "bulgaria.html", "Luxembourg": "luxemburgo.html"
  };

  // Informaci√≥n de divisas por pa√≠s
  const divisas = {
    "Germany": "Euro (‚Ç¨)", "France": "Euro (‚Ç¨)", "Spain": "Euro (‚Ç¨)", "Italy": "Euro (‚Ç¨)", "Portugal": "Euro (‚Ç¨)",
    "United Kingdom": "Libra esterlina (¬£)", "Ireland": "Euro (‚Ç¨)", "Poland": "Z≈Çoty (z≈Ç)", "Ukraine": "Grivna (‚Ç¥)",
    "Greece": "Euro (‚Ç¨)", "Sweden": "Corona sueca (kr)", "Norway": "Corona noruega (kr)", "Finland": "Euro (‚Ç¨)",
    "Austria": "Euro (‚Ç¨)", "Hungary": "Forinto (Ft)", "Switzerland": "Franco suizo (CHF)", "Belgium": "Euro (‚Ç¨)",
    "Netherlands": "Euro (‚Ç¨)", "Denmark": "Corona danesa (kr)", "Russia": "Rublo (‚ÇΩ)",
    "Romania": "Leu rumano (lei)", "Bulgaria": "Lev (–ª–≤)", "Czechia": "Corona checa (Kƒç)", "Slovakia": "Euro (‚Ç¨)",
    "Slovenia": "Euro (‚Ç¨)", "Croatia": "Euro (‚Ç¨)", "Serbia": "Dinar serbio (–¥–∏–Ω)", "Republic of Serbia": "Dinar serbio (–¥–∏–Ω)",
    "Bosnia and Herzegovina": "Marco convertible (KM)", "North Macedonia": "Dinar macedonio (–¥–µ–Ω)", "Montenegro": "Euro (‚Ç¨)",
    "Albania": "Lek (L)", "Iceland": "Corona islandesa (kr)", "Lithuania": "Euro (‚Ç¨)", "Latvia": "Euro (‚Ç¨)", "Estonia": "Euro (‚Ç¨)",
    "Moldova": "Leu moldavo (L)", "Belarus": "Rublo bielorruso (Br)", "Luxembourg": "Euro (‚Ç¨)", "Malta": "Euro (‚Ç¨)",
    "Andorra": "Euro (‚Ç¨)", "Monaco": "Euro (‚Ç¨)", "Liechtenstein": "Franco suizo (CHF)", "San Marino": "Euro (‚Ç¨)",
    "Vatican": "Euro (‚Ç¨)", "Kosovo": "Euro (‚Ç¨)", "Georgia": "Lari (‚Çæ)", "Armenia": "Dram (÷è)", "Azerbaijan": "Manat (‚Çº)",
    "Kazakhstan": "Tenge (‚Ç∏)"
  };

  // Cargar archivo GeoJSON de pa√≠ses y agregar estilo/interactividad
  fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
    .then(res => res.json())
    .then(data => {
      L.geoJSON(data, {
        style: (feature) => {
          const name = feature.properties.ADMIN || feature.properties.name || '';
          return {
            fillColor: paisesVerdes.has(name)
              ? '#70c167' // verde
              : paisesColoreadosImagen.has(name)
              ? '#e26a6a' // rojo
              : '#4a90e2', // azul
            fillOpacity: 0.7,
            color: '#555',
            weight: 1
          };
        },
        onEachFeature: (feature, layer) => {
          const rawName = feature.properties.ADMIN || feature.properties.name || "Sin nombre";
          const isoCodesManual = {
            "France": "fr", "Germany": "de", "Italy": "it", "Spain": "es", "Portugal": "pt",
            "Belgium": "be", "Poland": "pl", "Netherlands": "nl", "Luxembourg": "lu", "Bulgaria": "bg",
            "United Kingdom": "gb", "Ireland": "ie", "Switzerland": "ch", "Austria": "at", "Czechia": "cz",
            "Sweden": "se", "Norway": "no", "Denmark": "dk", "Finland": "fi"
          };

          const isoCode = isoCodesManual[rawName] || '';
          const banderaURL = isoCode ? `https://flagcdn.com/40x30/${isoCode}.png` : '';
          const moneda = divisas[rawName] || 'Moneda no especificada';

          layer.on('mouseover', (e) => {
            layer.setStyle({ fillOpacity: 0.9 });
            layer.getElement()?.classList.add('hovered');
            countryLabel.innerHTML = banderaURL
              ? `<img src="${banderaURL}"> <strong>${rawName}</strong> - ${moneda}`
              : `<strong>${rawName}</strong> - ${moneda}`;
            countryLabel.style.display = 'flex';
          });

          layer.on('mousemove', (e) => {
            countryLabel.style.left = (e.originalEvent.offsetX + 10) + 'px';
            countryLabel.style.top = (e.originalEvent.offsetY - 20) + 'px';
          });

          layer.on('mouseout', () => {
            layer.setStyle({ fillOpacity: 0.7 });
            layer.getElement()?.classList.remove('hovered');
            countryLabel.style.display = 'none';
          });

          layer.on('click', () => {
            if (paisesObjetivo[rawName]) {
              window.location.href = paisesObjetivo[rawName];
            } else {
              const img = banderaURL
                ? `<img src="${banderaURL}" width="40" height="30" style="margin-bottom:4px;"><br>` : '';
              L.popup()
                .setLatLng(layer.getBounds().getCenter())
                .setContent(`${img}<strong>${rawName}</strong><br>${moneda}<br>Informaci√≥n general`)
                .openOn(map);
            }
          });
        }
      }).addTo(map);
            let path = L.polyline.antPath([ruta.origen, ruta.destino], {
    color: "#ffc107",
    weight: 4,
    opacity: 0.8,
    dashArray: [10, 20],
    pulseColor: "#fff",
    paused: false,
    hardwareAccelerated: true
}).addTo(map);
path.bringToFront();


      // ---- PUERTOS y AEROPUERTOS ----
      const puertos = [
        { name: "Puerto de G√©nova", coords: [44.404, 8.932] },
        { name: "Puerto de Hamburgo", coords: [53.54, 9.99] },
        { name: "Puerto de R√≥terdam", coords: [51.95, 4.13] },
        { name: "Puerto de Le Havre", coords: [49.493, 0.107] },
        { name: "Puerto de Algeciras", coords: [36.127, -5.441] },
        { name: "Puerto de Amberes-Brujas", coords: [51.263, 4.400] },
        { name: "Puerto de Mertert", coords: [49.7014, 6.4806] },
        { name: "Puerto de Lisboa", coords: [38.708, -9.137] },
        { name: "Puerto de Burgas", coords: [42.49, 27.48] },
        { name: "Puerto de Gda≈Ñsk", coords: [54.35, 18.666] }
      ];

      const aeropuertos = [
{ name: "Aeropuerto Leonardo da Vinci‚ÄìFiumicino", coords: [41.805, 12.252] },
        { name: "Aeropuerto de √Åmsterdam-Schiphol (AMS)", coords: [52.31, 4.768] },
        { name: "Aeropuerto Charles de Gaulle (Par√≠s)", coords: [49.009, 2.547] },
        { name: "Aeropuerto Adolfo Su√°rez Madrid-Barajas", coords: [40.472, -3.562] },
        { name: "Aeropuerto de Bruselas (Zaventem)", coords: [50.901, 4.485] },
        { name: "Aeropuerto de Luxemburgo (Findel)", coords: [49.626, 6.213] },
        { name: "Aeropuerto de Sof√≠a", coords: [42.694, 23.406] },
        { name: "Aeropuerto de Lisboa", coords: [38.774, -9.134] },
        { name: "Aeropuerto Chopin de Varsovia", coords: [52.166, 20.967] },
        { name: "Aeropuerto de Frankfurt", coords: [50.037, 8.562] }
      ];

      // --- A√±ade los marcadores SOLO a los grupos ---
      puertos.forEach(p => {
        const marker = L.circleMarker(p.coords, {
          radius: 6,
          color: '#0057b8',
          fillColor: '#0057b8',
          fillOpacity: 0.9
        }).bindPopup(`üõ≥Ô∏è <strong>${p.name}</strong>`);
        marker.on("mouseover", () => marker.openPopup());
        marker.on("mouseout", () => marker.closePopup());
        marker.on("click", () => {
          const cleanName = p.name.toLowerCase().replace("puerto de ", "").replace(/[^a-z0-9]/g, "_");
          window.location.href = `puerto_${cleanName}.html`;
        });
        layerGroupPuertos.addLayer(marker); // ‚úÖ A√ëADE SOLO AL GRUPO, NO AL MAPA
      });

      aeropuertos.forEach(a => {
        const marker = L.circleMarker(a.coords, {
          radius: 6,
          color: '#d62828',
          fillColor: '#d62828',
          fillOpacity: 0.9
        }).bindPopup(`<strong>‚úàÔ∏è ${a.name}</strong>`);
        marker.on("mouseover", () => marker.openPopup());
        marker.on("mouseout", () => marker.closePopup());
        layerGroupAeropuertos.addLayer(marker); // ‚úÖ A√ëADE SOLO AL GRUPO, NO AL MAPA
      });

      // Las capas ya est√°n ligadas al control de Leaflet y aparecer√°n/desaparecer√°n correctamente
    });
</script>
<div id="leyenda-mapa" style="
  position: absolute; bottom: 30px; left: 20px; z-index: 1000;
  background: rgba(255,255,255,0.93); border-radius: 10px; padding: 14px 24px;
  box-shadow: 0 2px 8px #0002; font-family: Poppins, Arial, sans-serif; font-size: 16px;">
  <div style="margin-bottom: 4px;"><span style="color:#1976d2; font-size: 1.2em;">‚óè</span> <b>Puertos</b></div>
  <div style="margin-bottom: 4px;"><span style="color:#e53935; font-size: 1.2em;">‚óè</span> <b>Aeropuertos</b></div>
</div>
        </body>
        </html>
